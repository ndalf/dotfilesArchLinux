const filesInDirectory=dir=>new Promise((resolve=>dir.createReader().readEntries((entries=>Promise.all(entries.filter((e=>"."!==e.name[0])).map((e=>e.isDirectory?filesInDirectory(e):new Promise((resolve=>e.file(resolve)))))).then((files=>[].concat(...files))).then(resolve))))),timestampForFilesInDirectory=dir=>filesInDirectory(dir).then((files=>files.map((f=>f.name+f.lastModifiedDate)).join())),reload=()=>{chrome.tabs.query({active:!0,currentWindow:!0},(tabs=>{tabs[0]&&chrome.tabs.reload(tabs[0].id),chrome.runtime.reload()}))},watchChanges=(dir,lastTimestamp)=>{timestampForFilesInDirectory(dir).then((timestamp=>{lastTimestamp&&lastTimestamp!==timestamp?chrome.tabs.query({active:!0,currentWindow:!0},(tabs=>{tabs[0]&&chrome.tabs.reload(tabs[0].id),chrome.runtime.reload()})):setTimeout((()=>watchChanges(dir,timestamp)),1e3)}))};chrome.management.getSelf((self=>{"development"===self.installType&&chrome.runtime.getPackageDirectoryEntry((dir=>watchChanges(dir)))}));